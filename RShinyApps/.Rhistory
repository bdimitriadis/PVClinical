"$sum": 1
}
}
},
{ "$sort":
{
"_id": 1
}
}
]')}
x <- createDateAllQuery('2018-01-01', '2018-03-30')
t <- con$aggregate(x)
t
createEventsAllQuery<-function(startdate, enddate){
paste0('[
{
"$match": {
"receiptdate": {
"$gte": "',paste0(startdate, "T00:00:00.000+00:00"),'",
"$lte": "',paste0(enddate, "T00:00:00.000+00:00"),'"
}
}
},
{
"$unwind": {
"path": "$reaction"
}
}, {
"$group": {
"_id": {
"$toUpper": "$reaction"
},
"count": {
"$sum": 1
}
}
}, {
"$sort": {
"_id": 1
}
}
]')}
x <- createEventsAllQuery('2018-01-01', '2018-03-30')
t <- con$aggregate(x)
Ï„
createConDrugQuery<-function(drugName, startdate, enddate){
paste0('[{ "$match" :
"$and":[
{ "drugreaction": {
"$not" : { "$size" : 0 }
},
"drugreaction": {
"$eq" : "',paste0('1_',drugName),'"
}
},
{
"receiptdate": {
"$gte": "',paste0(startdate, "T00:00:00.000+00:00"),'",
"$lte": "',paste0(enddate, "T00:00:00.000+00:00"),'"
}
}
]
},
{ "$unwind":
{"path": "$drug"}
},
{ "$unwind":
{"path": "$drug"}
},
{ "$group":{
"_id": {
"$toUpper": "$drug"
},
"count": {
"$sum": 1
}
}
},
{"$sort":
{
"count": -1
}
}
]')
}
createConDrugQuery<-function(drugName, startdate, enddate){
paste0('[{ "$match" :
"$and":[
{ "drugreaction": {
"$not" : { "$size" : 0 }
},
"drugreaction": {
"$eq" : "',paste0('1_',drugName),'"
}
},
{
"receiptdate": {
"$gte": "',paste0(startdate, "T00:00:00.000+00:00"),'",
"$lte": "',paste0(enddate, "T00:00:00.000+00:00"),'"
}
}
]
},
{ "$unwind":
{"path": "$drug"}
},
{ "$unwind":
{"path": "$drug"}
},
{ "$group":{
"_id": {
"$toUpper": "$drug"
},
"count": {
"$sum": 1
}
}
},
{"$sort":
{
"count": -1
}
}
]')
}
x <- createConDrugQuery('L01CA04', '2018-01-01', '2018-03-30')
t <- con$aggregate(x)
createConDrugQuery<-function(drugName, startdate, enddate){
paste0('[{ "$match" :
"$and":[
{{ "drugreaction": {
"$not" : { "$size" : 0 }
},
"drugreaction": {
"$eq" : "',paste0('1_',drugName),'"
}
}},
{
"receiptdate": {
"$gte": "',paste0(startdate, "T00:00:00.000+00:00"),'",
"$lte": "',paste0(enddate, "T00:00:00.000+00:00"),'"
}
}
]
},
{ "$unwind":
{"path": "$drug"}
},
{ "$unwind":
{"path": "$drug"}
},
{ "$group":{
"_id": {
"$toUpper": "$drug"
},
"count": {
"$sum": 1
}
}
},
{"$sort":
{
"count": -1
}
}
]')
}
x <- createConDrugQuery('L01CA04', '2018-01-01', '2018-03-30')
t <- con$aggregate(x)
createConDrugQuery<-function(drugName, startdate, enddate){
paste0('[{ "$match" : {
"$and":[
{
{ "drugreaction": {
"$not" : { "$size" : 0 }
},
"drugreaction": {
"$eq" : "',paste0('1_',drugName),'"
}
}
},
{
"receiptdate": {
"$gte": "',paste0(startdate, "T00:00:00.000+00:00"),'",
"$lte": "',paste0(enddate, "T00:00:00.000+00:00"),'"
}
}
]
}
},
{ "$unwind":
{"path": "$drug"}
},
{ "$unwind":
{"path": "$drug"}
},
{ "$group":{
"_id": {
"$toUpper": "$drug"
},
"count": {
"$sum": 1
}
}
},
{"$sort":
{
"count": -1
}
}
]')
}
x <- createConDrugQuery('L01CA04', '2018-01-01', '2018-03-30')
t <- con$aggregate(x)
createConDrugQuery<-function(drugName, startdate, enddate){
paste0('[{ "$match" : {
"$and":[
{ "drugreaction": {
"$not" : { "$size" : 0 }
},
"drugreaction": {
"$eq" : "',paste0('1_',drugName),'"
}
},
{
"receiptdate": {
"$gte": "',paste0(startdate, "T00:00:00.000+00:00"),'",
"$lte": "',paste0(enddate, "T00:00:00.000+00:00"),'"
}
}
]
}
},
{ "$unwind":
{"path": "$drug"}
},
{ "$unwind":
{"path": "$drug"}
},
{ "$group":{
"_id": {
"$toUpper": "$drug"
},
"count": {
"$sum": 1
}
}
},
{"$sort":
{
"count": -1
}
}
]')
}
x <- createConDrugQuery('L01CA04', '2018-01-01', '2018-03-30')
t <- con$aggregate(x)
createConEventQuery<-function(eventName){
paste0('[{ "$match" : {
"$and":[
{ "drugreaction": {
"$not" : { "$size" : 0 }
},
"drugreaction": {
"$eq" : "',eventName,'"
}
},
{
"receiptdate": {
"$gte": "',paste0(startdate, "T00:00:00.000+00:00"),'",
"$lte": "',paste0(enddate, "T00:00:00.000+00:00"),'"
}
}
]
}
},
{ "$unwind":
{"path": "$reaction"}
},
{ "$unwind":
{"path": "$reaction"}
},
{ "$group":{
"_id": {
"$toUpper": "$reaction"
},
"count": {
"$sum": 1
}
}
},
{"$sort":
{
"count": -1
}
}
]')
}
x <- createConEventQuery('10051398', '2018-01-01', '2018-03-30')
createConEventQuery<-function(eventName, startdate, enddate){
paste0('[{ "$match" : {
"$and":[
{ "drugreaction": {
"$not" : { "$size" : 0 }
},
"drugreaction": {
"$eq" : "',eventName,'"
}
},
{
"receiptdate": {
"$gte": "',paste0(startdate, "T00:00:00.000+00:00"),'",
"$lte": "',paste0(enddate, "T00:00:00.000+00:00"),'"
}
}
]
}
},
{ "$unwind":
{"path": "$reaction"}
},
{ "$unwind":
{"path": "$reaction"}
},
{ "$group":{
"_id": {
"$toUpper": "$reaction"
},
"count": {
"$sum": 1
}
}
},
{"$sort":
{
"count": -1
}
}
]')
}
x <- createConEventQuery('10051398', '2018-01-01', '2018-03-30')
t <- con$aggregate(x)
TimeseriesForTotalReports<-function(startdate, enddate){
paste0('[
{
"$match": {
"$and":
{
"drugreaction": {
"$not": {
"$size": 0
}
}
},
{
"receiptdate": {
"$gte": "',paste0(startdate, "T00:00:00.000+00:00"),'",
"$lte": "',paste0(enddate, "T00:00:00.000+00:00"),'"
}
}
]
}
}, {
"$group": {
"_id": {
"$toUpper": "$receiptdate"
},
"count": {
"$sum": 1
}
}
}, {
"$sort": {
"_id": 1
}
}
]')}
x <- TimeseriesForTotalReports('2018-01-01', '2018-03-30')
t <- con$aggregate(x)
TimeseriesForTotalReports<-function(startdate, enddate){
paste0('[
{
"$match": {
"$and": [
{
"drugreaction": {
"$not": {
"$size": 0
}
}
},
{
"receiptdate": {
"$gte": "',paste0(startdate, "T00:00:00.000+00:00"),'",
"$lte": "',paste0(enddate, "T00:00:00.000+00:00"),'"
}
}
]
}
}, {
"$group": {
"_id": {
"$toUpper": "$receiptdate"
},
"count": {
"$sum": 1
}
}
}, {
"$sort": {
"_id": 1
}
}
]')}
x <- TimeseriesForTotalReports('2018-01-01', '2018-03-30')
t <- con$aggregate(x)
t
SearchDrugReports<-function(drugName, startdate, enddate){
paste0('[
{
"$match": {
"$and": [
{
"drugreaction": {
"$eq": "',paste0('1_',drugName),'"
}
},
{
"receiptdate": {
"$gte": "',paste0(startdate, "T00:00:00.000+00:00"),'",
"$lte": "',paste0(enddate, "T00:00:00.000+00:00"),'"
}
}
]
}
}, {
"$project": {
"safetyreportid": 1,
"_id": 0
}
}
]')}
x <- SearchDrugReports('L01CA04', '2018-01-01', '2018-03-30')
t <- con$aggregate(x)
t
SearchEventReports<-function(eventName, startdate, enddate){
paste0('[
{
"$match": {
"$and":[
{
"drugreaction": {
"$eq": "',eventName,'"
}
},
{
"receiptdate": {
"$gte": "',paste0(startdate, "T00:00:00.000+00:00"),'",
"$lte": "',paste0(enddate, "T00:00:00.000+00:00"),'"
}
}
]
}
}, {
"$project": {
"safetyreportid": 1,
"_id": 0
}
}
]')}
x <- SearchEventReports('10051398', '2018-01-01', '2018-03-30')
t <- con$aggregate(x)
t
SearchDrugEventReports<-function(drugName, eventName, startdate, enddate){
paste0('[
{
"$match": {
"$and": [
{
"$and": [
{
"drugreaction": {
"$eq": "',paste0('1_',drugName),'"
}
}, {
"drugreaction": {
"$eq": "',eventName,'"
}
}
]
},
{
"receiptdate": {
"$gte": "',paste0(startdate, "T00:00:00.000+00:00"),'",
"$lte": "',paste0(enddate, "T00:00:00.000+00:00"),'"
}
}
]
}
}, {
"$project": {
"safetyreportid": 1,
"_id": 0
}
}
]')}
x <- SearchEventReports('L01CA04','10051398', '2018-01-01', '2018-03-30')
x <- SearchDrugEventReports('L01CA04','10051398', '2018-01-01', '2018-03-30')
t <- con$aggregate(x)
t
shiny::runApp('ChangePoint')
runApp('ChangePoint')
