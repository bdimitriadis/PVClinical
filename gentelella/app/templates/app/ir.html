{% extends 'app/form_base.html' %}
{% load i18n %}
{% load staticfiles %}
{% load crispy_forms_tags %}
{% load crispy_forms_field %}
{% load custom_tags %}


{% block javascripts %}
    {{ block.super }}

	<!-- Select 2 css -->
	{{ form.media.js }}
    <script src='{% static "build/js/ir.js" %}'></script>
    {% if read_only == 0 %}
        <script>
            $("#topPVLogo, div.nav_menu, div.left_col, form#languageForm").css({"display":"none"});;
            $(".tile_count,.right_col").css({"background-color":"white"});
        </script>
    {% endif %}
{% endblock %}

{% block stylesheets %}
  {{ block.super }}
{% endblock stylesheets %}

{% block title %} {{title}} {% endblock %}

{% block formcontent %}
    {{ form|as_crispy_errors }}

    <h1> {{ title }}</h1>


    <div class="viewExplanation mt-3 mb-3">{% trans "Το <b>Ποσοστό Επίπτωσης</b> είναι ένα μέτρο της συχνότητας με την οποία εμφανίζεται μια ασθένεια ή κάποιο άλλο συμβάν σε μια καθορισμένη χρονική περίοδο." %}</div>
    {{ form.sc_id }}
    <div class="mt-3">
        <div class="row">

            <div id="ageCrit" name="ageCrit" >{{ form.age_crit|as_crispy_field }}</div>
            <div id="ageLimitsCont" class="row col-xs-offset-1 mt-3 mb-1">
    <!--        <div class="row mt-3">-->
                <div id="ageLimit" class="col-xs-12 col-sm-4" name="ageLimit">{{ form.age|as_crispy_field }}</div>
                <div id="andDiv" class="col-xs-12 col-sm-4">
                    <i class="fa fa-child fa-sm"></i>
                    <i class="fa fa-child fa-lg"></i>
                    <div id="ageConj" class="ml-5 mr-5">και</div>
                    <i class="fa fa-child fa-2x"></i>
                    <i class="fa fa-child fa-3x"></i>
                </div>
    <!--        </div>-->
    <!--        <div class="row mb-3">-->
                <div id="extAgeLimit" class="col-xs-12 col-sm-4" name="extAgeLimit">{{ form.ext_age|as_crispy_field }}</div>
    <!--        </div>-->
            </div>
        </div>


        <div id="genders" class="mt-2" name="genders">
            <div class="invalid-feedback">{{fld.errors}}</div>
            <label for="genders" class="col-form-label ">
                {{ form.genders.label }}
            </label>
            <ul id="genderChoices">
                {% for fld in form.genders %}
                    <li class='gender-fld col-xs-12 col-sm-6'>{{fld.tag}} <!-- this is the checkbox input generated by django -->
                        <label for="{{fld.id_for_label}}">{{fld.choice_label}}</label>
                        <i class="{% if fld.data.value == 'MALE' %}fa fa-mars{% elif fld.data.value == 'FEMALE' %}fa fa-venus{% else %}fa fa-transgender-alt{% endif %}"></i></i>
                    </li>
                {% endfor %}
            </ul>
<!--            {{ form.genders|as_crispy_field }}-->
        </div>
        <div id="addStudyWindow" class="mt-3" name="addStudyWindow">{{ form.add_study_window|as_crispy_field }}</div>
        <div class="mb-3">
            <div class="row middle-align">
                <div id="studyStartDate" name="studyStartDate" class="col-xs-11">
                    {{ form.study_start_date|as_crispy_field }}
                </div>
                <div class="col-xs-1 calendar-icon-div">
                    <i class="fa fa-calendar"></i>
                </div>
            </div>
            <div class="row middle-align">
                <div id="studyEndDate" name="studyEndDate" class="col-xs-11">
                        {{ form.study_end_date|as_crispy_field }}
                </div>
                <div class="col-xs-1 calendar-icon-div">
                        <i class="fa fa-calendar"></i>
                </div>
            </div>
        </div>
    </div>



    <div class="iframe-cnt">
        <iframe id="irframe" src="{{ results_url}}"></iframe>
    </div>

{% endblock %}

{% block toolbarbuttons %}
    <div class="btn-group col-xs-10 col-lg-8 col-xs-offset-1 col-lg-offset-2 mt-4" role="group" aria-label="Toolbar buttons">
        {% if read_only == 1 %}
            <button class="btn btn-primary col-xs-4" data-toggle="modal" data-target="#editIRModal" type="button">
                <i class="fa fa-edit"></i>
                <span class="visible-lg">
                    {% trans "Επεξεργασία" %}
                </span>
            </button>

            <button class="btn btn-danger col-xs-4 d-{{visibility}}" data-toggle="modal" data-target="#analysisConfirmModal" type="button">
                    <i class="fa fa-bar-chart"></i>
                    <span class="visible-lg">
                        {% trans "Ανάλυση" %}
                     </span>
            </button>


            <a class="btn btn-dark col-xs-4" type="button"
                href="{% url 'ohdsi_workspace' sc_id %}">
                <i class="fa fa-reply"></i>
                <span class="visible-lg">
                    {% trans "Επιστροφή" %}
                </span>
            </a>
        {% else %}
            <button id="irSaveBtn" class="btn btn-primary col-xs-4 col-xs-offset-1" type="submit">
                <i class="fa fa-save"></i>
                <span class="visible-sm">
                    {% trans "Αποθήκευση" %}
                </span>
            </button>

            <button id="irCancelBtn" class="btn btn-danger col-xs-4" type="button" data-dismiss="modal">
                    <i class="fa fa-hand-paper-o"></i>
                    <span class="visible-sm">
                        {% trans "Ακύρωση" %}
                     </span>
            </button>
        {% endif %}

    </div>

{% trans "Επιβεβαίωση ανάλυσης" as analysis_mod_title %}
{% trans "Συνέχεια" as continue_lbl%}
{% trans "Ακύρωση" as dismiss_lbl %}
{% trans "Βεβαιωθείτε ότι αποθηκεύσατε τις αλλαγές για να δείτε τη νέα ανάλυση, διαφορετικά θα επαναλάβετε την ανάλυση με τις προηγούμενες τιμές παραμέτρων" as analysis_mod_body%}
{% include 'app/modals/parametric_modal.html' with modal_type="\"confirmModal\"" modal_id="analysisConfirmModal" modal_title=analysis_mod_title modal_body=analysis_mod_body main_btn=continue_lbl dismiss_btn=dismiss_lbl data_target="#analysisViewModal" %}


{% trans "Επεξεργασία παραμέτρων ανάλυσης" as editIR_mod_title %}
{% trans "Αποθήκευση" as save_lbl %}
{% with editIR_mod_body="<iframe allowfullscreen src='"|add:request.get_full_path|add:"/0'></iframe>" %}
    {% include 'app/modals/parametric_modal.html' with modal_type="\"viewModal\"" modal_id="editIRModal" modal_title=editIR_mod_title modal_body=editIR_mod_body|safe main_btn=save_lbl dismiss_btn=dismiss_lbl data_target="#analysisViewModal" %}
{% endwith %}

{% endblock %}





